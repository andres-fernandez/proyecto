<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>d3.js | Bibliotecas populares en Argentina</title>
  <!-- <script src="https://d3js.org/d3.v7.min.js"></script> -->
  <link rel="stylesheet" href="styles.css">
  <script src="d3.min.js"></script>
  <script src="simpleheat.js"></script>
  <script src="00 - establecimientos-educativos.js" defer></script>
  <script src="01 - bibliotecas.js" defer></script>
  <script src="02 - bibliotecas-ii.js" defer></script>
  <script src="03 - bibliotecas-por-departamento.js" defer></script>
  <script src="04 - bibliotecas-por-departamento-ii.js" defer></script>
  <script src="05 - habitantes-por-biblioteca.js" defer></script>
  <script src="06 - habitantes-por-biblioteca-ii.js" defer></script>
  <!-- <script src="07 - bibliotecas-por-provincia.js" defer></script> -->
  <script src="08 - bibliotecas-por-provincia-ii.js" defer></script>
</head>
<body>

<!-- ///// Escuelas /////////////////////////////////////// -->

  <section data-render="Establecimientos educativos en Argentina">
    <div id="dataviz_escuelas"></div>
    <h2>Establecimientos Educativos</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
      <button data-view><img src="./img/eye.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Bibliotecas I ////////////////////////////////// -->

  <section data-render="Bibliotecas populares en Argentina">
    <div id="dataviz_bibliotecas"></div>
    <h2>Bibliotecas populares - I</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
      <button data-view><img src="./img/eye.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Bibliotecas II ///////////////////////////////// -->

  <section data-render="Bibliotecas populares en Argentina">
    <div id="dataviz_bibliotecas_ii"></div>
    <h2>Bibliotecas populares - II</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Biliotecas por departamento ///////////////// -->

  <section data-render="Bibliotecas populares por departamento">
    <div id="dataviz_departamentos"></div>
    <h2>Bibliotecas populares por departamento - I</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Bibliotecas por departamentos II //////////// -->

  <section data-render="Habitantes por biblioteca popular por departamento - II">
    <div id="dataviz_departamentos_ii"></div>
    <h2>Bibliotecas populares por departamento - II</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Habitantes por biblioteca ////////////////// -->

  <section data-render="Habitantes por biblioteca popular por departamento">
    <div id="dataviz_habitantes"></div>
    <h2>Habitantes por biblioteca popular - I</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Habitantes por biblioteca II //////////////// -->

  <section data-render="Habitantes por biblioteca popular por departamento - II">
    <div id="dataviz_habitantes_ii"></div>
    <h2>Habitantes por biblioteca popular - II</h2>
    <div class="interactive">
      <button data-download><img src="./img/download.svg" alt=""></button>
    </div>
  </section>

<!-- ///// Biliotecas por provincia //////////////////// -->

  <section data-render="Bibliotecas por provincia">
    <h2>Bibliotecas populares por provincia</h2>
    <div id="dataviz_provincias"></div>
  </section>

<!-- ///// Script /////////////////////////////////////// -->

  <script>
  function view_and_download(e) {
    const eTarget = e.target;
    if (eTarget.matches('button[data-download]')) {
      const     container = eTarget.parentElement.parentElement;
      const      map_name = container.dataset.render;
      let     dataviz_svg = container.querySelector('svg').outerHTML;
              dataviz_svg = dataviz_svg.replace('width="450"', '').replace('height="750"', '');
      const     save_date = new Date().toLocaleString("sv-SE").replace(' ', '__').replace(':', 'y').slice(0, -3);
      const      fileName = `${map_name} - ${save_date}.svg`;
      const  downloadLink = document.createElement('a');
      downloadLink.setAttribute('download', fileName);
      downloadLink.setAttribute('href', 'data: image/svg+xml, ' + encodeURIComponent(dataviz_svg));
      downloadLink.click();
    } else {
      eTarget.classList.toggle('dimmed');
      const container = eTarget.parentElement.parentElement;
      console.log(container)
      const canvas = container.querySelector('canvas').classList.toggle('hidden');
    }
  }
    
  document.body.addEventListener('click', view_and_download);
  </script>
</body>
</html>